"use strict";(self["webpackChunkele_admin_template"]=self["webpackChunkele_admin_template"]||[]).push([[3989],{81618:function(e){(function(t,s){e.exports=s()})(0,(function(){function e(e){var i=[];return e.AMapUI&&i.push(t(e.AMapUI)),e.Loca&&i.push(s(e.Loca)),Promise.all(i)}function t(e){return new Promise((function(t,s){var r=[];if(e.plugins)for(var l=0;l<e.plugins.length;l+=1)-1==o.AMapUI.plugins.indexOf(e.plugins[l])&&r.push(e.plugins[l]);if(n.AMapUI===i.failed)s("前次请求 AMapUI 失败");else if(n.AMapUI===i.notload){n.AMapUI=i.loading,o.AMapUI.version=e.version||o.AMapUI.version,l=o.AMapUI.version;var c=document.body||document.head,p=document.createElement("script");p.type="text/javascript",p.src="https://webapi.amap.com/ui/"+l+"/main.js",p.onerror=function(e){n.AMapUI=i.failed,s("请求 AMapUI 失败")},p.onload=function(){if(n.AMapUI=i.loaded,r.length)window.AMapUI.loadUI(r,(function(){for(var e=0,s=r.length;e<s;e++){var i=r[e].split("/").slice(-1)[0];window.AMapUI[i]=arguments[e]}for(t();a.AMapUI.length;)a.AMapUI.splice(0,1)[0]()}));else for(t();a.AMapUI.length;)a.AMapUI.splice(0,1)[0]()},c.appendChild(p)}else n.AMapUI===i.loaded?e.version&&e.version!==o.AMapUI.version?s("不允许多个版本 AMapUI 混用"):r.length?window.AMapUI.loadUI(r,(function(){for(var e=0,s=r.length;e<s;e++){var i=r[e].split("/").slice(-1)[0];window.AMapUI[i]=arguments[e]}t()})):t():e.version&&e.version!==o.AMapUI.version?s("不允许多个版本 AMapUI 混用"):a.AMapUI.push((function(e){e?s(e):r.length?window.AMapUI.loadUI(r,(function(){for(var e=0,s=r.length;e<s;e++){var i=r[e].split("/").slice(-1)[0];window.AMapUI[i]=arguments[e]}t()})):t()}))}))}function s(e){return new Promise((function(t,s){if(n.Loca===i.failed)s("前次请求 Loca 失败");else if(n.Loca===i.notload){n.Loca=i.loading,o.Loca.version=e.version||o.Loca.version;var r=o.Loca.version,l=o.AMap.version.startsWith("2"),c=r.startsWith("2");if(l&&!c||!l&&c)s("JSAPI 与 Loca 版本不对应！！");else{l=o.key,c=document.body||document.head;var p=document.createElement("script");p.type="text/javascript",p.src="https://webapi.amap.com/loca?v="+r+"&key="+l,p.onerror=function(e){n.Loca=i.failed,s("请求 AMapUI 失败")},p.onload=function(){for(n.Loca=i.loaded,t();a.Loca.length;)a.Loca.splice(0,1)[0]()},c.appendChild(p)}}else n.Loca===i.loaded?e.version&&e.version!==o.Loca.version?s("不允许多个版本 Loca 混用"):t():e.version&&e.version!==o.Loca.version?s("不允许多个版本 Loca 混用"):a.Loca.push((function(e){e?s(e):s()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var i;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(i||(i={}));var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},n={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},a={AMap:[],AMapUI:[],Loca:[]},r=[],l=function(e){"function"==typeof e&&(n.AMap===i.loaded?e(window.AMap):r.push(e))};return{load:function(t){return new Promise((function(s,a){if(n.AMap==i.failed)a("");else if(n.AMap==i.notload){var c=t.key,p=t.version,d=t.plugins;c?(window.AMap&&"lbs.amap.com"!==location.host&&a("禁止多种API加载方式混用"),o.key=c,o.AMap.version=p||o.AMap.version,o.AMap.plugins=d||o.AMap.plugins,n.AMap=i.loading,p=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)n.AMap=i.failed,a(o);else for(n.AMap=i.loaded,e(t).then((function(){s(window.AMap)}))["catch"](a);r.length;)r.splice(0,1)[0]()},d=document.createElement("script"),d.type="text/javascript",d.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+c+"&plugin="+o.AMap.plugins.join(","),d.onerror=function(e){n.AMap=i.failed,a(e)},p.appendChild(d)):a("请填写key")}else if(n.AMap==i.loaded)if(t.key&&t.key!==o.key)a("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)a("不允许多个版本 JSAPI 混用");else{if(c=[],t.plugins)for(p=0;p<t.plugins.length;p+=1)-1==o.AMap.plugins.indexOf(t.plugins[p])&&c.push(t.plugins[p]);c.length?window.AMap.plugin(c,(function(){e(t).then((function(){s(window.AMap)}))["catch"](a)})):e(t).then((function(){s(window.AMap)}))["catch"](a)}else if(t.key&&t.key!==o.key)a("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)a("不允许多个版本 JSAPI 混用");else{var h=[];if(t.plugins)for(p=0;p<t.plugins.length;p+=1)-1==o.AMap.plugins.indexOf(t.plugins[p])&&h.push(t.plugins[p]);l((function(){h.length?window.AMap.plugin(h,(function(){e(t).then((function(){s(window.AMap)}))["catch"](a)})):e(t).then((function(){s(window.AMap)}))["catch"](a)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},n={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},a={AMap:[],AMapUI:[],Loca:[]}}}}))},93989:function(e,t,s){s.r(t),s.d(t,{default:function(){return U}});var i=function(){var e=this,t=e._self._c;return t("el-card",{attrs:{shadow:"never",header:"地图位置选择器"}},[t("div",{staticStyle:{display:"flex","align-items":"center"}},[t("div",{staticStyle:{width:"140px","margin-right":"12px"}},[t("el-select",{staticClass:"ele-fluid",attrs:{size:"small"},model:{value:e.searchType,callback:function(t){e.searchType=t},expression:"searchType"}},[t("el-option",{attrs:{label:"POI检索模式",value:0}}),t("el-option",{attrs:{label:"关键字检索模式",value:1}})],1)],1),t("el-button",{staticClass:"ele-btn-icon",attrs:{size:"small"},on:{click:e.openMapPicker}},[e._v(" 打开地图位置选择器 ")])],1),t("div",{staticStyle:{"margin-top":"12px"}},[e._v("选择位置: "+e._s(e.result.location))]),t("div",{staticStyle:{"margin-top":"12px"}},[e._v("详细地址: "+e._s(e.result.address))]),t("div",{staticStyle:{"margin-top":"12px"}},[e._v(" 经 纬 度 : "+e._s(e.result.coordinate))]),t("ele-map-picker",{attrs:{"need-city":!0,show:e.visible,"lock-scroll":!1,"close-on-click-modal":!1,"search-type":e.searchType,"dark-mode":e.darkMode},on:{"update:show":function(t){e.visible=t},done:e.onChoose}})],1)},o=[],n=s(83647),a=s(56618),r=(s(21703),s(81618)),l=s.n(r),c=s(92061);const p={height:{type:String,default:"450px"},center:Array,zoom:{type:Number,default:11},chooseZoom:{type:Number,default:17},poiSize:{type:Number,default:30},poiType:{type:String,default:""},poiKeywords:{type:String,default:""},poiRadius:{type:Number,default:1e3},needCity:Boolean,forceChoose:{type:Boolean,default:!0},suggestionCity:{type:String,default:"全国"},searchType:{type:Number,default:0,validator:e=>[0,1].includes(e)},searchPlaceholder:String,markerSrc:{type:String,default:"https://3gimg.qq.com/lightmap/components/locationPicker2/image/marker.png"},mapKey:String,mapVersion:{type:String,default:"2.0"},mapStyle:String,darkMode:Boolean,okText:String,tipMessage:String};function d(e,t,s,i,o,n,a,r){var l,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=s,c._compiled=!0),i&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),a?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},c._ssrRegister=l):o&&(l=r?function(){o.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:o),l)if(c.functional){c._injectStyles=l;var p=c.render;c.render=function(e,t){return l.call(t),p(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:c}}const h="ele-map-picker-main-icon",u={name:"MapView",mixins:[c.u],props:p,emits:["done","map-done"],data(){return{loading:!0,poiLoading:!1,confirmLoading:!1,data:[],suggestionData:[],centerIconClass:["ele-map-picker-main-icon"],keywords:"",lastSuggestion:"",selectedSuggestion:null,isItemClickMove:!1,mapIns:null,placeSearchIns:null,autoCompleteIns:null,centerMarker:null}},computed:{searchPopClass(){const e=["ele-map-picker-search-pop"];return 0!==this.searchType&&e.push("ele-map-picker-hide"),e.join(" ")}},methods:{renderMap(){this.mapKey&&!this.mapIns&&l().load({key:this.mapKey,version:this.mapVersion,plugins:["AMap.PlaceSearch","AMap.AutoComplete"]}).then((e=>{this.destroyAll(),this.autoCompleteIns=new e.AutoComplete({city:this.suggestionCity}),this.placeSearchIns=new e.PlaceSearch({type:this.poiType,pageSize:this.poiSize,pageIndex:1});const t=(()=>this.mapStyle?this.mapStyle:this.darkMode?"amap://styles/dark":void 0)();this.mapIns=new e.Map(this.$refs.mapRef,{zoom:this.zoom,center:this.center,resizeEnable:!0,mapStyle:t}),this.mapIns.on("complete",(()=>{this.loading=!1;const{lng:e,lat:t}=this.mapIns.getCenter();this.searchPoi(e,t)})),this.mapIns.on("moveend",(()=>{if(this.isItemClickMove)this.isItemClickMove=!1;else if(0===this.searchType){this.bounceIcon();const{lng:e,lat:t}=this.mapIns.getCenter();this.searchPoi(e,t)}})),this.centerMarker=new e.Marker({icon:new e.Icon({image:this.markerSrc,size:new e.Size(26,36.5),imageSize:new e.Size(26,36.5)}),offset:new e.Pixel(-13,-36.5)}),this.$emit("map-done",this.mapIns)})).catch((e=>{console.error(e)}))},onSearch(e,t){e&&this.lastSuggestion!==e?(this.lastSuggestion=e,0!==this.searchType&&(this.poiLoading=!0),this.searchKeywords(e).then((e=>{0!==this.searchType?(this.data=e,this.poiLoading=!1,this.removeCenterMarker(),t([])):(this.suggestionData=e,t(this.suggestionData))})).catch((e=>{console.error(e),this.poiLoading=!1}))):t(this.suggestionData)},onSelect(e){this.data.length&&this.data[0].name===e.name||(this.data=[{...e,selected:!0},...this.data.map((e=>({...e,selected:!1})))]),this.setMapCenter(e.location.lng,e.location.lat,this.chooseZoom),this.selectedSuggestion=e},onChoose(e){this.isItemClickMove=!0,this.data=this.data.map((t=>({...t,selected:t===e})));const{lng:t,lat:s}=e.location;this.setMapCenter(t,s,this.chooseZoom),0===this.searchType?this.bounceIcon():this.showCenterMarker(t,s)},onSuggestionBlur(){0===this.searchType&&(this.suggestionKeyWords="")},onDone(){if(!this.authenticated)return void console.warn(c.c);const e=this.getSelected();if(!e)return this.forceChoose?void this.$message.error(this.tipMessage):(this.confirmLoading=!0,void this.getMapCenter(this.needCity).then((e=>{this.confirmLoading=!1,this.$emit("done",e)})).catch((e=>{console.error(e),this.confirmLoading=!1,this.$emit("done",{})})));const t={...e.location,name:e.name,address:e.address||""};this.needCity?(this.confirmLoading=!0,this.setMapCenter(t.lng,t.lat),this.getMapCenter(!0).then((({city:e})=>{this.confirmLoading=!1,t.city=e,this.$emit("done",t)})).catch((e=>{console.error(e),this.confirmLoading=!1,this.$emit("done",t)}))):this.$emit("done",t)},searchKeywords(e){return new Promise(((t,s)=>{this.autoCompleteIns?this.autoCompleteIns.search(e,((e,s)=>{if(!(null==s?void 0:s.tips))return void t([]);const i=s.tips.filter((e=>!!e.location)).map(((e,t)=>{const s=`${e.name}(${e.district})`;return{...e,text:s,value:s,key:e.id||s+"-"+t,address:Array.isArray(e.address)?e.address[0]:e.address}}));t(i)})):s(new Error("AutoComplete instance is null"))}))},searchPoi(e,t){this.poiLoading=!0,this.searchNearBy(e,t).then((e=>{this.selectedSuggestion?0===e.length||e[0].name!==this.selectedSuggestion.name?this.data=[{...this.selectedSuggestion,selected:!0},...e]:this.data=e.map(((e,t)=>({...e,selected:0===t}))):this.data=e,this.poiLoading=!1})).catch((e=>{console.error(e),this.poiLoading=!1,this.data=[]}))},searchNearBy(e,t){return new Promise(((s,i)=>{this.placeSearchIns?this.placeSearchIns.searchNearBy(this.poiKeywords,[e,t],this.poiRadius,((e,t)=>{var o;if("complete"===e&&(null==(o=null==t?void 0:t.poiList)?void 0:o.pois)){const e=t.poiList.pois.filter((e=>!!e.location)).map(((e,t)=>({...e,key:e.id||e.name+"-"+t})));s(e)}else"no_data"===e?s([]):i(new Error(e))})):i(new Error("PlaceSearch instance is null"))}))},getSelected(){return this.data.find((e=>e.selected))},bounceIcon(){this.centerIconClass=[h],this.$nextTick((()=>{setTimeout((()=>{this.centerIconClass=[h,"ele-map-picker-anim-bounce"]}),0)}))},removeCenterMarker(){this.centerMarker&&this.mapIns&&this.mapIns.remove(this.centerMarker)},showCenterMarker(e,t){this.centerMarker?this.mapIns?null!=e&&null!=t?(this.centerMarker.setPosition([e,t]),this.mapIns.add(this.centerMarker)):this.removeCenterMarker():console.error("map instance is null"):console.error("centerMarker is null")},setMapCenter(e,t,s){this.mapIns&&null!=e&&null!=t&&(null==s?this.mapIns.setCenter([e,t]):this.mapIns.setZoomAndCenter(s,[e,t]))},getMapCenter(e){return new Promise(((t,s)=>{if(!this.mapIns)return void s(new Error("map instance is null"));const i=this.mapIns.getCenter();e?this.mapIns.getCity((e=>{i.city=e,t(i)})):t(i)}))},changeMapStyle(e){this.mapIns&&("boolean"===typeof e?e?this.mapIns.setMapStyle("amap://styles/dark"):this.mapIns.setMapStyle("amap://styles/normal"):e&&this.mapIns.setMapStyle(e))},destroyMap(){this.mapIns&&this.mapIns.destroy(),this.centerMarker=null,this.placeSearchIns=null,this.autoCompleteIns=null,this.mapIns=null},destroyAll(){this.destroyMap(),this.data=[],this.suggestionData=[],this.keywords="",this.lastSuggestion="",this.selectedSuggestion=null,this.isItemClickMove=!1},getMapIns(){return this.mapIns}},watch:{darkMode(e){this.mapStyle||this.changeMapStyle(e)},mapStyle(e){e&&this.changeMapStyle(e)},searchType(e){if(this.keywords="",this.suggestionData=[],this.selectedSuggestion=null,this.lastSuggestion="",this.removeCenterMarker(),1===e){const e=this.getSelected();if(e){const{lng:t,lat:s}=e.location;this.showCenterMarker(t,s)}}},mapKey(){this.destroyAll(),this.renderMap()}},mounted(){this.renderMap()},unmounted(){this.destroyAll()}};var m=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[t("div",{staticClass:"ele-map-picker-header"},[t("div",{staticClass:"ele-map-picker-header-search"},[t("el-autocomplete",{attrs:{size:"small","fetch-suggestions":e.onSearch,placeholder:e.searchPlaceholder||e.t("ele.map.placeholder"),"popper-class":e.searchPopClass},on:{select:e.onSelect,blur:e.onSuggestionBlur},scopedSlots:e._u([{key:"suffix",fn:function(){return[t("i",{staticClass:"el-icon-search el-input__icon"})]},proxy:!0},{key:"default",fn:function({item:s}){return[t("div",{staticClass:"ele-map-picker-suggestion-item",attrs:{title:s.text}},[e._v(" "+e._s(s.text)+" ")])]}}]),model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}})],1),t("el-button",{staticClass:"ele-btn-icon",attrs:{size:"small",type:"primary",icon:"el-icon-check",loading:e.confirmLoading},on:{click:e.onDone}},[e._v(" "+e._s(e.okText)+" ")])],1),t("div",{staticClass:"ele-map-picker-body"},[t("div",{staticClass:"ele-map-picker-main"},[t("div",{ref:"mapRef",style:{height:e.height}}),0===e.searchType?[t("i",{staticClass:"ele-map-picker-main-plus el-icon-plus"}),t("img",{class:e.centerIconClass,attrs:{src:e.markerSrc,alt:""}})]:e._e()],2),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.poiLoading,expression:"poiLoading"}],staticClass:"ele-map-picker-poi-list",style:{height:e.height}},e._l(e.data,(function(s){return t("div",{key:s.key,class:["ele-map-picker-poi-item",{active:s.selected}],on:{click:function(t){return e.onChoose(s)}}},[t("i",{staticClass:"ele-map-picker-poi-item-icon el-icon-location-outline"}),t("div",{staticClass:"ele-map-picker-poi-item-title"},[e._v(e._s(s.name))]),s.address?t("div",{staticClass:"ele-map-picker-poi-item-address"},[e._v(" "+e._s(s.address)+" ")]):e._e(),t("i",{staticClass:"el-icon-circle-check ele-map-picker-poi-item-check"})])})),0)])])},g=[],f=d(u,m,g,!1,null,null,null,null);const y=f.exports;var v=s(67904);const M={...v.$7,...p,show:Boolean,title:String,width:{type:String,default:"780px"}};function k(e,t,s,i,o,n,a,r){var l,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=s,c._compiled=!0),i&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),a?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},c._ssrRegister=l):o&&(l=r?function(){o.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:o),l)if(c.functional){c._injectStyles=l;var p=c.render;c.render=function(e,t){return l.call(t),p(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:c}}const w={name:"EleMapPicker",components:{EleModal:a.Z,MapView:y},mixins:[n["default"]],props:M,inject:{proLayout:{default:null}},emits:["done","open","closed","update:show","map-done"],data(){return{enable:!1}},computed:{dialogClass(){const e=["ele-map-picker-dialog"];return this.customClass&&e.push(this.customClass),this.styleResponsive&&e.push("ele-map-picker-responsive"),e.join(" ")},aMapKey(){const e=this.$ELEADMIN;return this.mapKey||(null==e?void 0:e.mapKey)},styleResponsive(){var e,t;const s=null!=(e=this.proLayout)?e:{};return null==(t=s.styleResponsive)||t}},methods:{onOpen(){this.enable=!0,this.$emit("open")},onClosed(){this.destroyOnClose&&(this.enable=!1),this.$emit("closed")},onDone(e){this.$emit("done",e)},onMapDone(e){this.$emit("map-done",e)},updateVisible(e){this.$emit("update:show",e)}}};var C=function(){var e=this,t=e._self._c;return t("EleModal",{attrs:{visible:e.show,title:e.title||e.t("ele.map.title"),width:e.width,top:e.top,modal:e.modal,"modal-append-to-body":e.modalAppendToBody,"append-to-body":e.appendToBody,"lock-scroll":e.lockScroll,"custom-class":e.dialogClass,"close-on-click-modal":e.closeOnClickModal,"close-on-press-escape":e.closeOnPressEscape,"show-close":e.showClose,"destroy-on-close":e.destroyOnClose,movable:e.movable,"move-out":e.moveOut,"move-out-positive":e.moveOutPositive,resizable:e.resizable,maxable:e.maxable,multiple:e.multiple,fullscreen:e.fullscreen,inner:e.inner,"reset-on-close":e.resetOnClose,centered:e.centered,"mask-keep-alive":!1},on:{open:e.onOpen,closed:e.onClosed,"update:visible":e.updateVisible},scopedSlots:e._u([e._l(Object.keys(e.$scopedSlots).filter((e=>"default"!==e)),(function(t){return{key:t,fn:function(s){return[e._t(t,null,null,s||{})]}}}))],null,!0)},[e.enable?t("MapView",{ref:"mapRef",attrs:{height:e.height,center:e.center,zoom:e.zoom,chooseZoom:e.chooseZoom,poiSize:e.poiSize,poiType:e.poiType,poiKeywords:e.poiKeywords,poiRadius:e.poiRadius,needCity:e.needCity,forceChoose:e.forceChoose,suggestionCity:e.suggestionCity,searchType:e.searchType,searchPlaceholder:e.searchPlaceholder||e.t("ele.map.placeholder"),markerSrc:e.markerSrc,mapKey:e.aMapKey,mapVersion:e.mapVersion,mapStyle:e.mapStyle,darkMode:e.darkMode,okText:e.okText||e.t("ele.map.ok"),tipMessage:e.t("ele.map.message")},on:{done:e.onDone,"map-done":e.onMapDone}}):e._e()],1)},I=[],A=k(w,C,I,!1,null,null,null,null);const S=A.exports;var _={components:{EleMapPicker:S},data(){return{visible:!1,searchType:0,result:{location:"",address:"",coordinate:""}}},computed:{darkMode(){return this.$store?.state?.theme?.darkMode}},methods:{onChoose(e){console.log(e),this.result={location:[e.city.province,e.city.city,e.city.district].join("/"),address:e.name+" "+e.address,coordinate:e.lng+","+e.lat},this.visible=!1},openMapPicker(){this.visible=!0}}},b=_,L=s(1001),x=(0,L.Z)(b,i,o,!1,null,null,null),U=x.exports}}]);