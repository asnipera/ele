(self["webpackChunkele_admin_template"]=self["webpackChunkele_admin_template"]||[]).push([[7953,221,4548],{50221:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return p}});var s=function(){var e=this,t=e._self._c;return t("ele-modal",{attrs:{width:"680px",visible:e.visible,"append-to-body":!0,"close-on-click-modal":!0,"custom-class":"ele-dialog-form",title:e.isUpdate?"修改用户":"添加用户"},on:{"update:visible":e.updateVisible},scopedSlots:e._u([{key:"footer",fn:function(){return[t("el-button",{on:{click:function(t){return e.updateVisible(!1)}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.save}},[e._v(" 保存 ")])]},proxy:!0}])},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"82px"}},[t("el-row",{attrs:{gutter:15}},[t("el-col",e._b({},"el-col",e.styleResponsive?{sm:12}:{span:12},!1),[t("el-form-item",{attrs:{label:"用户账号:",prop:"username"}},[t("el-input",{attrs:{clearable:"",maxlength:20,disabled:e.isUpdate,placeholder:"请输入用户账号"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),t("el-form-item",{attrs:{label:"用户名:",prop:"nickname"}},[t("el-input",{attrs:{clearable:"",maxlength:20,placeholder:"请输入用户名"},model:{value:e.form.nickname,callback:function(t){e.$set(e.form,"nickname",t)},expression:"form.nickname"}})],1),t("el-form-item",{attrs:{label:"性别:",prop:"sex"}},[t("el-select",{staticClass:"ele-block",attrs:{clearable:"",placeholder:"请选择性别"},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[t("el-option",{attrs:{label:"男",value:"1"}}),t("el-option",{attrs:{label:"女",value:"2"}})],1)],1),t("el-form-item",{attrs:{label:"角色:",prop:"roleIds"}},[t("role-select",{model:{value:e.form.roleIds,callback:function(t){e.$set(e.form,"roleIds",t)},expression:"form.roleIds"}})],1),t("el-form-item",{attrs:{label:"邮箱:",prop:"email"}},[t("el-input",{attrs:{clearable:"",maxlength:100,placeholder:"请输入邮箱"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)],1),t("el-col",e._b({},"el-col",e.styleResponsive?{sm:12}:{span:12},!1),[t("el-form-item",{attrs:{label:"手机号:",prop:"phone"}},[t("el-input",{attrs:{clearable:"",maxlength:11,placeholder:"请输入手机号"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),t("el-form-item",{attrs:{label:"出生日期:",prop:"birthday"}},[t("el-date-picker",{staticClass:"ele-fluid",attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"请选择出生日期"},model:{value:e.form.birthday,callback:function(t){e.$set(e.form,"birthday",t)},expression:"form.birthday"}})],1),e.isUpdate?e._e():t("el-form-item",{attrs:{label:"登录密码:",prop:"password"}},[t("el-input",{attrs:{"show-password":"",maxlength:20,placeholder:"请输入登录密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),t("el-form-item",{attrs:{label:"个人简介:"}},[t("el-input",{attrs:{rows:4,clearable:"",type:"textarea",maxlength:200,placeholder:"请输入个人简介"},model:{value:e.form.introduction,callback:function(t){e.$set(e.form,"introduction",t)},expression:"form.introduction"}})],1)],1)],1)],1)],1)},r=[],o=l(95082),n=(l(21703),l(21249),l(33721)),a=l(84045),i=l(59477),c={components:{RoleSelect:a["default"]},props:{visible:Boolean,data:Object},data:function(){var e=this,t={userId:null,username:"",nickname:"",sex:null,roleIds:[],email:"",phone:"",birthday:"",password:"",introduction:""};return{defaultForm:t,form:(0,o.Z)({},t),rules:{username:[{required:!0,trigger:"blur",validator:function(t,l,s){var r;if(!e.isUpdate)return l?void(0,i.mL)("username",l,null===(r=e.data)||void 0===r?void 0:r.username).then((function(){s(new Error("账号已经存在"))})).catch((function(){s()})):s(new Error("请输入用户账号"));s()}}],nickname:[{required:!0,message:"请输入用户名",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",trigger:"blur"}],roleIds:[{required:!0,message:"请选择角色",trigger:"blur"}],email:[{pattern:n.m0,message:"邮箱格式不正确",trigger:"blur"}],password:[{required:!0,pattern:/^[\S]{5,18}$/,message:"密码必须为5-18位非空白字符",trigger:"blur"}],phone:[{pattern:n.$v,message:"手机号格式不正确",trigger:"blur"}]},loading:!1,isUpdate:!1}},computed:{styleResponsive:function(){return this.$store.state.theme.styleResponsive}},methods:{save:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;e.loading=!0;var l=(0,o.Z)((0,o.Z)({},e.form),{},{roles:e.form.roleIds.map((function(e){return{roleId:e}}))}),s=e.isUpdate?i.Nq:i.cn;s(l).then((function(t){e.loading=!1,e.$message.success(t),e.updateVisible(!1),e.$emit("done")})).catch((function(t){e.loading=!1,e.$message.error(t.message)}))}))},updateVisible:function(e){this.$emit("update:visible",e)}},watch:{visible:function(e){e?this.data?(this.$util.assignObject(this.form,(0,o.Z)((0,o.Z)({},this.data),{},{roleIds:this.data.roles.map((function(e){return e.roleId})),password:""})),this.isUpdate=!0):this.isUpdate=!1:(this.$refs.form.clearValidate(),this.form=(0,o.Z)({},this.defaultForm))}}},u=c,d=l(1001),m=(0,d.Z)(u,s,r,!1,null,null,null),p=m.exports},1104:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return u}});var s=function(){var e=this,t=e._self._c;return t("ele-modal",{attrs:{width:"520px",title:"导入用户",visible:e.visible},on:{"update:visible":e.updateVisible}},[t("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"ele-block",attrs:{drag:"",action:"",accept:".xls,.xlsx","show-file-list":!1,"before-upload":e.doUpload},scopedSlots:e._u([{key:"tip",fn:function(){return[t("div",{staticClass:"el-upload__tip ele-text-center"},[t("span",[e._v("只能上传xls、xlsx文件, ")]),t("el-link",{staticStyle:{"vertical-align":"baseline"},attrs:{download:"",href:e.url,type:"primary",underline:!1}},[e._v(" 下载模板 ")])],1)]},proxy:!0}])},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处, 或 "),t("em",[e._v("点击上传")])])])],1)},r=[],o=(l(26699),l(59477)),n={props:{visible:Boolean},data:function(){return{loading:!1,url:"https://cdn.eleadmin.com/20200610/用户导入模板.xlsx"}},methods:{doUpload:function(e){var t=this;return["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type)?e.size/1024/1024>10?(this.$message.error("大小不能超过 10MB"),!1):(this.loading=!0,(0,o.we)(e).then((function(e){t.loading=!1,t.$message.success(e),t.updateVisible(!1),t.$emit("done")})).catch((function(e){t.loading=!1,t.$message.error(e.message)})),!1):(this.$message.error("只能选择 excel 文件"),!1)},updateVisible:function(e){this.$emit("update:visible",e)}}},a=n,i=l(1001),c=(0,i.Z)(a,s,r,!1,null,"7ddf1efc",null),u=c.exports},54548:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return u}});l(74916),l(64765);var s=function(){var e=this,t=e._self._c;return t("el-form",{staticClass:"ele-form-search",attrs:{"label-width":"77px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search.apply(null,arguments)},submit:function(e){e.preventDefault()}}},[t("el-row",{attrs:{gutter:15}},[t("el-col",e._b({},"el-col",e.styleResponsive?{lg:6,md:12}:{span:6},!1),[t("el-form-item",{attrs:{label:"用户账号:"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入"},model:{value:e.where.username,callback:function(t){e.$set(e.where,"username",t)},expression:"where.username"}})],1)],1),t("el-col",e._b({},"el-col",e.styleResponsive?{lg:6,md:12}:{span:6},!1),[t("el-form-item",{attrs:{label:"用户名:"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入"},model:{value:e.where.nickname,callback:function(t){e.$set(e.where,"nickname",t)},expression:"where.nickname"}})],1)],1),t("el-col",e._b({},"el-col",e.styleResponsive?{lg:6,md:12}:{span:6},!1),[t("el-form-item",{attrs:{label:"性别:"}},[t("el-select",{staticClass:"ele-fluid",attrs:{clearable:"",placeholder:"请选择"},model:{value:e.where.sex,callback:function(t){e.$set(e.where,"sex",t)},expression:"where.sex"}},[t("el-option",{attrs:{label:"男",value:1}}),t("el-option",{attrs:{label:"女",value:2}})],1)],1)],1),t("el-col",e._b({},"el-col",e.styleResponsive?{lg:6,md:12}:{span:6},!1),[t("div",{staticClass:"ele-form-actions"},[t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v(" 查询 ")]),t("el-button",{on:{click:e.reset}},[e._v("重置")])],1)])],1)],1)},r=[],o=l(95082),n={data:function(){var e={username:"",nickname:"",sex:void 0};return{where:(0,o.Z)({},e)}},computed:{styleResponsive:function(){return this.$store.state.theme.styleResponsive}},methods:{search:function(){this.$emit("search",this.where)},reset:function(){this.where=(0,o.Z)({},this.defaultWhere),this.search()}}},a=n,i=l(1001),c=(0,i.Z)(a,s,r,!1,null,null,null),u=c.exports},27953:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return f}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ele-body"},[t("el-card",{attrs:{shadow:"never"}},[t("user-search",{on:{search:e.reload}}),t("ele-pro-table",{ref:"table",attrs:{columns:e.columns,datasource:e.datasource,selection:e.selection,"cache-key":"systemUserTable"},on:{"update:selection":function(t){e.selection=t}},scopedSlots:e._u([{key:"toolbar",fn:function(){return[t("el-button",{staticClass:"ele-btn-icon",attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.openEdit()}}},[e._v(" 新建 ")]),t("el-button",{staticClass:"ele-btn-icon",attrs:{size:"small",type:"danger",icon:"el-icon-delete"},on:{click:e.removeBatch}},[e._v(" 删除 ")]),t("el-button",{staticClass:"ele-btn-icon",attrs:{size:"small",icon:"el-icon-upload2"},on:{click:e.openImport}},[e._v(" 导入 ")])]},proxy:!0},{key:"nickname",fn:function(l){var s=l.row;return[t("router-link",{attrs:{to:"/system/user/details?id="+s.userId}},[e._v(" "+e._s(s.nickname)+" ")])]}},{key:"roles",fn:function(l){var s=l.row;return e._l(s.roles,(function(l){return t("el-tag",{key:l.roleId,attrs:{size:"mini",type:"primary","disable-transitions":!0}},[e._v(" "+e._s(l.roleName)+" ")])}))}},{key:"status",fn:function(l){var s=l.row;return[t("el-switch",{attrs:{"active-value":0,"inactive-value":1},on:{change:function(t){return e.editStatus(s)}},model:{value:s.status,callback:function(t){e.$set(s,"status",t)},expression:"row.status"}})]}},{key:"action",fn:function(l){var s=l.row;return[t("el-link",{attrs:{type:"primary",underline:!1,icon:"el-icon-edit"},on:{click:function(t){return e.openEdit(s)}}},[e._v(" 修改 ")]),t("el-link",{attrs:{type:"primary",underline:!1,icon:"el-icon-key"},on:{click:function(t){return e.resetPsw(s)}}},[e._v(" 重置密码 ")]),t("el-popconfirm",{staticClass:"ele-action",attrs:{title:"确定要删除此用户吗？"},on:{confirm:function(t){return e.remove(s)}},scopedSlots:e._u([{key:"reference",fn:function(){return[t("el-link",{attrs:{type:"danger",underline:!1,icon:"el-icon-delete"}},[e._v(" 删除 ")])]},proxy:!0}],null,!0)})]}}])})],1),t("user-edit",{attrs:{visible:e.showEdit,data:e.current},on:{"update:visible":function(t){e.showEdit=t},done:e.reload}}),t("user-import",{attrs:{visible:e.showImport},on:{"update:visible":function(t){e.showImport=t},done:e.reload}})],1)},r=[],o=l(95082),n=(l(21249),l(54548)),a=l(50221),i=l(1104),c=l(59477),u={name:"SystemUser",components:{UserSearch:n["default"],UserEdit:a["default"],UserImport:i["default"]},data:function(){var e=this;return{columns:[{columnKey:"selection",type:"selection",width:45,align:"center",fixed:"left"},{columnKey:"index",type:"index",width:45,align:"center",showOverflowTooltip:!0,fixed:"left"},{prop:"username",label:"用户账号",sortable:"custom",showOverflowTooltip:!0,minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",showOverflowTooltip:!0,minWidth:110,slot:"nickname"},{prop:"sexName",label:"性别",sortable:"custom",showOverflowTooltip:!0,minWidth:80},{prop:"phone",label:"手机号",sortable:"custom",showOverflowTooltip:!0,minWidth:110},{columnKey:"roles",label:"角色",showOverflowTooltip:!0,minWidth:110,slot:"roles"},{prop:"createTime",label:"创建时间",sortable:"custom",showOverflowTooltip:!0,minWidth:110,formatter:function(t,l,s){return e.$util.toDateString(s)}},{prop:"status",label:"状态",align:"center",sortable:"custom",width:80,resizable:!1,slot:"status",showOverflowTooltip:!0},{columnKey:"action",label:"操作",width:220,align:"center",resizable:!1,slot:"action",showOverflowTooltip:!0}],selection:[],current:null,showEdit:!1,showImport:!1}},methods:{datasource:function(e){var t=e.page,l=e.limit,s=e.where,r=e.order;return(0,c.I0)((0,o.Z)((0,o.Z)((0,o.Z)({},s),r),{},{page:t,limit:l}))},reload:function(e){this.$refs.table.reload({page:1,where:e})},openEdit:function(e){this.current=e,this.showEdit=!0},openImport:function(){this.showImport=!0},remove:function(e){var t=this,l=this.$loading({lock:!0});(0,c.kX)(e.userId).then((function(e){l.close(),t.$message.success(e),t.reload()})).catch((function(e){l.close(),t.$message.error(e.message)}))},removeBatch:function(){var e=this;this.selection.length?this.$confirm("确定要删除选中的用户吗?","提示",{type:"warning"}).then((function(){var t=e.$loading({lock:!0});(0,c.bz)(e.selection.map((function(e){return e.userId}))).then((function(l){t.close(),e.$message.success(l),e.reload()})).catch((function(l){t.close(),e.$message.error(l.message)}))})).catch((function(){})):this.$message.error("请至少选择一条数据")},resetPsw:function(e){var t=this;this.$confirm('确定要重置此用户的密码为"123456"吗?',"提示",{type:"warning"}).then((function(){var l=t.$loading({lock:!0});(0,c.Zy)(e.userId).then((function(e){l.close(),t.$message.success(e)})).catch((function(e){l.close(),t.$message.error(e.message)}))})).catch((function(){}))},editStatus:function(e){var t=this,l=this.$loading({lock:!0});(0,c.OL)(e.userId,e.status).then((function(e){l.close(),t.$message.success(e)})).catch((function(s){l.close(),e.status=e.status?0:1,t.$message.error(s.message)}))}}},d=u,m=l(1001),p=(0,m.Z)(d,s,r,!1,null,null,null),f=p.exports},81150:function(e){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},64765:function(e,t,l){"use strict";var s=l(46916),r=l(27007),o=l(19670),n=l(68554),a=l(84488),i=l(81150),c=l(41340),u=l(58173),d=l(97651);r("search",(function(e,t,l){return[function(t){var l=a(this),r=n(t)?void 0:u(t,e);return r?s(r,t,l):new RegExp(t)[e](c(l))},function(e){var s=o(this),r=c(e),n=l(t,s,r);if(n.done)return n.value;var a=s.lastIndex;i(a,0)||(s.lastIndex=0);var u=d(s,r);return i(s.lastIndex,a)||(s.lastIndex=a),null===u?-1:u.index}]}))}}]);