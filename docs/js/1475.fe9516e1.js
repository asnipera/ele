"use strict";(self["webpackChunkele_admin_template"]=self["webpackChunkele_admin_template"]||[]).push([[1475,1067],{91067:function(e,t,o){o.r(t),o.d(t,{default:function(){return h}});var i=function(){var e=this,t=e._self._c;return t("ele-modal",{attrs:{top:"5vh",width:"1100px",visible:e.visible,title:"卷内文件调整","custom-class":"demo-file-sort-dialog"},on:{"update:visible":e.updateVisible},scopedSlots:e._u([{key:"footer",fn:function(){return[t("div",[t("el-button",{on:{click:e.close}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")])],1)]},proxy:!0}])},[t("el-row",{attrs:{gutter:15}},[t("el-col",e._b({},"el-col",e.styleResponsive?{md:8}:{span:8},!1),[t("ele-pro-table",{ref:"docTable",staticClass:"demo-file-sort-table",attrs:{"sub-title":"案卷列表",datasource:e.documents,columns:e.columns1,"highlight-current-row":"",height:"400px",toolkit:[],"need-page":!1,current:e.current,"tool-style":{lineHeight:"28px"}},on:{"update:current":function(t){e.current=t},done:e.onDocTbDone}})],1),t("el-col",e._b({},"el-col",e.styleResponsive?{md:8}:{span:8},!1),[t("ele-pro-table",{ref:"fileTable",attrs:{loading:e.loading,"sub-title":"卷内列表",datasource:e.data1,columns:e.columns2,height:"400px",selection:e.selection1,"need-page":!1,toolkit:[]},on:{"update:selection":function(t){e.selection1=t}},scopedSlots:e._u([{key:"toolkit",fn:function(){return[t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top",size:"mini"},on:{click:e.moveUp}},[e._v(" 上移 ")]),t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-bottom",size:"mini"},on:{click:e.moveDown}},[e._v(" 下移 ")]),t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top-right",size:"mini"},on:{click:e.moveOut}},[e._v(" 调出 ")])]},proxy:!0}])})],1),t("el-col",e._b({},"el-col",e.styleResponsive?{md:8}:{span:8},!1),[t("ele-pro-table",{attrs:{loading:e.loading,"sub-title":"未归档列表",datasource:e.data2,columns:e.columns2,height:"400px",selection:e.selection2,"need-page":!1,toolkit:[]},on:{"update:selection":function(t){e.selection2=t}},scopedSlots:e._u([{key:"toolkit",fn:function(){return[t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top-left",size:"mini"},on:{click:e.moveIn}},[e._v(" 调入 ")])]},proxy:!0}])})],1)],1)],1)},s=[],n=o(21513),l={props:{visible:Boolean,documents:{type:Array,required:!0}},data(){return{loading:!0,columns1:[{prop:"title",label:"案卷题名",width:110,showOverflowTooltip:!0},{prop:"piece_no",label:"案卷档号",showOverflowTooltip:!0}],columns2:[{columnKey:"selection",type:"selection",width:45,align:"center"},{prop:"title",label:"文件题名",width:110,showOverflowTooltip:!0},{prop:"archive_no",label:"文件档号",showOverflowTooltip:!0}],data:[],current:null,selection1:[],selection2:[]}},computed:{data1(){return this.current?this.data.filter((e=>e.piece_no===this.current.piece_no)):[]},data2(){return this.data.filter((e=>!e.piece_no))},styleResponsive(){return this.$store.state.theme.styleResponsive}},methods:{onDocTbDone(){this.documents.length&&this.$refs.docTable.setCurrentRow(this.documents[0])},query(){this.loading=!0,(0,n.v)({pieceNoIn:this.documents.map((e=>e.piece_no))}).then((e=>{this.loading=!1,this.data=e})).catch((e=>{this.loading=!1,this.$message.error(e.message)}))},moveUp(){if(!this.selection1.length)return void this.$message.error("请选择一条数据");if(this.selection1.length>1)return void this.$message.error("只能选择一条数据");if(0===this.data1.indexOf(this.selection1[0]))return;const e=this.data.indexOf(this.selection1[0]),t=this.data[e-1];this.$set(this.data,e-1,this.selection1[0]),this.$set(this.data,e,t),this.$nextTick((()=>{this.$refs.fileTable.toggleRowSelection(this.data[e-1],!0)}))},moveDown(){if(!this.selection1.length)return void this.$message.error("请选择一条数据");if(this.selection1.length>1)return void this.$message.error("只能选择一条数据");if(this.data1.indexOf(this.selection1[0])===this.data1.length-1)return;const e=this.data.indexOf(this.selection1[0]),t=this.data[e+1];this.$set(this.data,e+1,this.selection1[0]),this.$set(this.data,e,t),this.$nextTick((()=>{this.$refs.fileTable.toggleRowSelection(this.data[e+1],!0)}))},moveOut(){this.selection1.length?this.selection1.forEach((e=>{e.piece_no=""})):this.$message.error("请至少选择一条数据")},moveIn(){this.current&&(this.selection2.length?this.selection2.forEach((e=>{e.piece_no=this.current.piece_no})):this.$message.error("请至少选择一条数据"))},save(){const e=this.data.map((e=>({archive_no:e.archive_no,piece_no:e.piece_no})));console.log(e),this.updateVisible(!1)},close(){this.updateVisible(!1)},updateVisible(e){this.$emit("update:visible",e)}},watch:{visible(e){e?this.query():this.data=[]}}},r=l,a=o(1001),c=(0,a.Z)(r,i,s,!1,null,"b8860126",null),h=c.exports},71475:function(e,t,o){o.r(t),o.d(t,{default:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ele-body"},[t("el-card",{attrs:{shadow:"never"}},[t("ele-pro-table",{ref:"table",attrs:{columns:e.columns,datasource:e.datasource,selection:e.selection,"show-summary":!0,"summary-method":e.getSummaries,height:e.fixedHeight?"calc(100vh - 344px)":void 0},on:{"update:selection":function(t){e.selection=t}},scopedSlots:e._u([{key:"toolbar",fn:function(){return[t("el-button",{staticClass:"ele-btn-icon",attrs:{size:"small",type:"primary",icon:"el-icon-sort"},on:{click:e.openFileSortDialog}},[e._v(" 卷内文件调整 ")]),t("span",[e._v(" 固定高度 ")]),t("el-switch",{on:{change:e.destroyTable},model:{value:e.fixedHeight,callback:function(t){e.fixedHeight=t},expression:"fixedHeight"}})]},proxy:!0}])})],1),t("file-sort",{attrs:{visible:e.showFileSort,documents:e.fileSortChoose},on:{"update:visible":function(t){e.showFileSort=t}}})],1)},s=[],n=o(91067),l=o(21513),r={name:"ExampleDocument",components:{FileSort:n["default"]},data(){return{columns:[{columnKey:"selection",type:"selection",width:45,align:"center",fixed:"left"},{columnKey:"index",type:"index",width:45,align:"center",fixed:"left"},{prop:"piece_no",label:"案卷档号",width:215,minWidth:110,showOverflowTooltip:!0},{prop:"title",label:"案卷题名",minWidth:110,showOverflowTooltip:!0},{prop:"year",label:"年度",minWidth:110,showOverflowTooltip:!0},{prop:"retention",label:"保管期限",minWidth:110,showOverflowTooltip:!0},{prop:"secret",label:"密级",minWidth:110,showOverflowTooltip:!0},{prop:"type",label:"档案类别",minWidth:110,showOverflowTooltip:!0},{prop:"carrier",label:"载体规格",minWidth:110,showOverflowTooltip:!0},{prop:"amount",label:"件数",minWidth:110,showOverflowTooltip:!0}],showFileSort:!1,selection:[],fileSortChoose:[],fixedHeight:!1}},methods:{datasource({page:e,limit:t,where:o,order:i}){return(0,l.Z)({...o,...i,page:e,limit:t})},openFileSortDialog(){this.selection.length<2?this.$message.error("请至少选择两条数据"):(this.fileSortChoose=this.$refs.table.tableData.slice(0,3),this.showFileSort=!0)},getSummaries({columns:e,data:t}){const o=[];return e.forEach(((e,i)=>{2===i?o[i]="合计":"amount"===e.property&&(o[i]=t.map((t=>Number(t[e.property]))).reduce(((e,t)=>{const o=Number(t);return isNaN(o)?e:e+t}),0))})),o},destroyTable(){this.$refs.table.reRenderTable()}}},a=r,c=o(1001),h=(0,c.Z)(a,i,s,!1,null,null,null),d=h.exports},21513:function(e,t,o){o.d(t,{Z:function(){return s},v:function(){return n}});o(21703);var i=o(84471);async function s(e){const t=await i.Z.get("https://cdn.eleadmin.com/20200610/document.json",{params:e});return 0===t.data.code?t.data.data:Promise.reject(new Error(t.data.message))}async function n(e){const t=await i.Z.get("https://cdn.eleadmin.com/20200610/archive.json",{params:e});return 0===t.data.code?t.data.data:Promise.reject(new Error(t.data.message))}}}]);