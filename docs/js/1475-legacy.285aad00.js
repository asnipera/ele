"use strict";(self["webpackChunkele_admin_template"]=self["webpackChunkele_admin_template"]||[]).push([[1475,1067],{91067:function(e,t,o){o.r(t),o.d(t,{default:function(){return u}});var i=function(){var e=this,t=e._self._c;return t("ele-modal",{attrs:{top:"5vh",width:"1100px",visible:e.visible,title:"卷内文件调整","custom-class":"demo-file-sort-dialog"},on:{"update:visible":e.updateVisible},scopedSlots:e._u([{key:"footer",fn:function(){return[t("div",[t("el-button",{on:{click:e.close}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")])],1)]},proxy:!0}])},[t("el-row",{attrs:{gutter:15}},[t("el-col",e._b({},"el-col",e.styleResponsive?{md:8}:{span:8},!1),[t("ele-pro-table",{ref:"docTable",staticClass:"demo-file-sort-table",attrs:{"sub-title":"案卷列表",datasource:e.documents,columns:e.columns1,"highlight-current-row":"",height:"400px",toolkit:[],"need-page":!1,current:e.current,"tool-style":{lineHeight:"28px"}},on:{"update:current":function(t){e.current=t},done:e.onDocTbDone}})],1),t("el-col",e._b({},"el-col",e.styleResponsive?{md:8}:{span:8},!1),[t("ele-pro-table",{ref:"fileTable",attrs:{loading:e.loading,"sub-title":"卷内列表",datasource:e.data1,columns:e.columns2,height:"400px",selection:e.selection1,"need-page":!1,toolkit:[]},on:{"update:selection":function(t){e.selection1=t}},scopedSlots:e._u([{key:"toolkit",fn:function(){return[t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top",size:"mini"},on:{click:e.moveUp}},[e._v(" 上移 ")]),t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-bottom",size:"mini"},on:{click:e.moveDown}},[e._v(" 下移 ")]),t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top-right",size:"mini"},on:{click:e.moveOut}},[e._v(" 调出 ")])]},proxy:!0}])})],1),t("el-col",e._b({},"el-col",e.styleResponsive?{md:8}:{span:8},!1),[t("ele-pro-table",{attrs:{loading:e.loading,"sub-title":"未归档列表",datasource:e.data2,columns:e.columns2,height:"400px",selection:e.selection2,"need-page":!1,toolkit:[]},on:{"update:selection":function(t){e.selection2=t}},scopedSlots:e._u([{key:"toolkit",fn:function(){return[t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top-left",size:"mini"},on:{click:e.moveIn}},[e._v(" 调入 ")])]},proxy:!0}])})],1)],1)],1)},n=[],s=(o(57327),o(41539),o(21249),o(54747),o(21513)),r={props:{visible:Boolean,documents:{type:Array,required:!0}},data:function(){return{loading:!0,columns1:[{prop:"title",label:"案卷题名",width:110,showOverflowTooltip:!0},{prop:"piece_no",label:"案卷档号",showOverflowTooltip:!0}],columns2:[{columnKey:"selection",type:"selection",width:45,align:"center"},{prop:"title",label:"文件题名",width:110,showOverflowTooltip:!0},{prop:"archive_no",label:"文件档号",showOverflowTooltip:!0}],data:[],current:null,selection1:[],selection2:[]}},computed:{data1:function(){var e=this;return this.current?this.data.filter((function(t){return t.piece_no===e.current.piece_no})):[]},data2:function(){return this.data.filter((function(e){return!e.piece_no}))},styleResponsive:function(){return this.$store.state.theme.styleResponsive}},methods:{onDocTbDone:function(){this.documents.length&&this.$refs.docTable.setCurrentRow(this.documents[0])},query:function(){var e=this;this.loading=!0,(0,s.v)({pieceNoIn:this.documents.map((function(e){return e.piece_no}))}).then((function(t){e.loading=!1,e.data=t})).catch((function(t){e.loading=!1,e.$message.error(t.message)}))},moveUp:function(){var e=this;if(this.selection1.length){if(this.selection1.length>1)this.$message.error("只能选择一条数据");else if(0!==this.data1.indexOf(this.selection1[0])){var t=this.data.indexOf(this.selection1[0]),o=this.data[t-1];this.$set(this.data,t-1,this.selection1[0]),this.$set(this.data,t,o),this.$nextTick((function(){e.$refs.fileTable.toggleRowSelection(e.data[t-1],!0)}))}}else this.$message.error("请选择一条数据")},moveDown:function(){var e=this;if(this.selection1.length){if(this.selection1.length>1)this.$message.error("只能选择一条数据");else if(this.data1.indexOf(this.selection1[0])!==this.data1.length-1){var t=this.data.indexOf(this.selection1[0]),o=this.data[t+1];this.$set(this.data,t+1,this.selection1[0]),this.$set(this.data,t,o),this.$nextTick((function(){e.$refs.fileTable.toggleRowSelection(e.data[t+1],!0)}))}}else this.$message.error("请选择一条数据")},moveOut:function(){this.selection1.length?this.selection1.forEach((function(e){e.piece_no=""})):this.$message.error("请至少选择一条数据")},moveIn:function(){var e=this;this.current&&(this.selection2.length?this.selection2.forEach((function(t){t.piece_no=e.current.piece_no})):this.$message.error("请至少选择一条数据"))},save:function(){var e=this.data.map((function(e){return{archive_no:e.archive_no,piece_no:e.piece_no}}));console.log(e),this.updateVisible(!1)},close:function(){this.updateVisible(!1)},updateVisible:function(e){this.$emit("update:visible",e)}},watch:{visible:function(e){e?this.query():this.data=[]}}},l=r,a=o(1001),c=(0,a.Z)(l,i,n,!1,null,"b8860126",null),u=c.exports},71475:function(e,t,o){o.r(t),o.d(t,{default:function(){return p}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ele-body"},[t("el-card",{attrs:{shadow:"never"}},[t("ele-pro-table",{ref:"table",attrs:{columns:e.columns,datasource:e.datasource,selection:e.selection,"show-summary":!0,"summary-method":e.getSummaries,height:e.fixedHeight?"calc(100vh - 344px)":void 0},on:{"update:selection":function(t){e.selection=t}},scopedSlots:e._u([{key:"toolbar",fn:function(){return[t("el-button",{staticClass:"ele-btn-icon",attrs:{size:"small",type:"primary",icon:"el-icon-sort"},on:{click:e.openFileSortDialog}},[e._v(" 卷内文件调整 ")]),t("span",[e._v(" 固定高度 ")]),t("el-switch",{on:{change:e.destroyTable},model:{value:e.fixedHeight,callback:function(t){e.fixedHeight=t},expression:"fixedHeight"}})]},proxy:!0}])})],1),t("file-sort",{attrs:{visible:e.showFileSort,documents:e.fileSortChoose},on:{"update:visible":function(t){e.showFileSort=t}}})],1)},n=[],s=o(95082),r=(o(47042),o(41539),o(54747),o(21249),o(9653),o(91067)),l=o(21513),a={name:"ExampleDocument",components:{FileSort:r["default"]},data:function(){return{columns:[{columnKey:"selection",type:"selection",width:45,align:"center",fixed:"left"},{columnKey:"index",type:"index",width:45,align:"center",fixed:"left"},{prop:"piece_no",label:"案卷档号",width:215,minWidth:110,showOverflowTooltip:!0},{prop:"title",label:"案卷题名",minWidth:110,showOverflowTooltip:!0},{prop:"year",label:"年度",minWidth:110,showOverflowTooltip:!0},{prop:"retention",label:"保管期限",minWidth:110,showOverflowTooltip:!0},{prop:"secret",label:"密级",minWidth:110,showOverflowTooltip:!0},{prop:"type",label:"档案类别",minWidth:110,showOverflowTooltip:!0},{prop:"carrier",label:"载体规格",minWidth:110,showOverflowTooltip:!0},{prop:"amount",label:"件数",minWidth:110,showOverflowTooltip:!0}],showFileSort:!1,selection:[],fileSortChoose:[],fixedHeight:!1}},methods:{datasource:function(e){var t=e.page,o=e.limit,i=e.where,n=e.order;return(0,l.Z)((0,s.Z)((0,s.Z)((0,s.Z)({},i),n),{},{page:t,limit:o}))},openFileSortDialog:function(){this.selection.length<2?this.$message.error("请至少选择两条数据"):(this.fileSortChoose=this.$refs.table.tableData.slice(0,3),this.showFileSort=!0)},getSummaries:function(e){var t=e.columns,o=e.data,i=[];return t.forEach((function(e,t){2===t?i[t]="合计":"amount"===e.property&&(i[t]=o.map((function(t){return Number(t[e.property])})).reduce((function(e,t){var o=Number(t);return isNaN(o)?e:e+t}),0))})),i},destroyTable:function(){this.$refs.table.reRenderTable()}}},c=a,u=o(1001),h=(0,u.Z)(c,i,n,!1,null,null,null),p=h.exports},21513:function(e,t,o){o.d(t,{Z:function(){return r},v:function(){return a}});var i=o(50124),n=o(48534),s=(o(41539),o(21703),o(84471));function r(e){return l.apply(this,arguments)}function l(){return l=(0,n.Z)((0,i.Z)().mark((function e(t){var o;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s.Z.get("https://cdn.eleadmin.com/20200610/document.json",{params:t});case 2:if(o=e.sent,0!==o.data.code){e.next=5;break}return e.abrupt("return",o.data.data);case 5:return e.abrupt("return",Promise.reject(new Error(o.data.message)));case 6:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function a(e){return c.apply(this,arguments)}function c(){return c=(0,n.Z)((0,i.Z)().mark((function e(t){var o;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s.Z.get("https://cdn.eleadmin.com/20200610/archive.json",{params:t});case 2:if(o=e.sent,0!==o.data.code){e.next=5;break}return e.abrupt("return",o.data.data);case 5:return e.abrupt("return",Promise.reject(new Error(o.data.message)));case 6:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}}}]);