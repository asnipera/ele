"use strict";(self["webpackChunkele_admin_template"]=self["webpackChunkele_admin_template"]||[]).push([[7953,4045,221,1104,4131],{84045:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("el-select",{staticClass:"ele-block",attrs:{multiple:"",clearable:"",value:e.value,placeholder:e.placeholder},on:{input:e.updateValue}},e._l(e.data,(function(e){return t("el-option",{key:e.roleId,attrs:{value:e.roleId,label:e.roleName}})})),1)},r=[],o=s(49967),n={props:{value:Array,placeholder:{type:String,default:"请选择角色"}},data(){return{data:[]}},created(){(0,o.xv)().then((e=>{this.data=e})).catch((e=>{this.$message.error(e.message)}))},methods:{updateValue(e){this.$emit("input",e)}}},l=n,i=s(1001),c=(0,i.Z)(l,a,r,!1,null,null,null),u=c.exports},50221:function(e,t,s){s.r(t),s.d(t,{default:function(){return m}});var a=function(){var e=this,t=e._self._c;return t("ele-modal",{attrs:{width:"680px",visible:e.visible,"append-to-body":!0,"close-on-click-modal":!0,"custom-class":"ele-dialog-form",title:e.isUpdate?"修改用户":"添加用户"},on:{"update:visible":e.updateVisible},scopedSlots:e._u([{key:"footer",fn:function(){return[t("el-button",{on:{click:function(t){return e.updateVisible(!1)}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.save}},[e._v(" 保存 ")])]},proxy:!0}])},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"82px"}},[t("el-row",{attrs:{gutter:15}},[t("el-col",e._b({},"el-col",e.styleResponsive?{sm:12}:{span:12},!1),[t("el-form-item",{attrs:{label:"用户账号:",prop:"username"}},[t("el-input",{attrs:{clearable:"",maxlength:20,disabled:e.isUpdate,placeholder:"请输入用户账号"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),t("el-form-item",{attrs:{label:"用户名:",prop:"nickname"}},[t("el-input",{attrs:{clearable:"",maxlength:20,placeholder:"请输入用户名"},model:{value:e.form.nickname,callback:function(t){e.$set(e.form,"nickname",t)},expression:"form.nickname"}})],1),t("el-form-item",{attrs:{label:"性别:",prop:"sex"}},[t("el-select",{staticClass:"ele-block",attrs:{clearable:"",placeholder:"请选择性别"},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[t("el-option",{attrs:{label:"男",value:"1"}}),t("el-option",{attrs:{label:"女",value:"2"}})],1)],1),t("el-form-item",{attrs:{label:"角色:",prop:"roleIds"}},[t("role-select",{model:{value:e.form.roleIds,callback:function(t){e.$set(e.form,"roleIds",t)},expression:"form.roleIds"}})],1),t("el-form-item",{attrs:{label:"邮箱:",prop:"email"}},[t("el-input",{attrs:{clearable:"",maxlength:100,placeholder:"请输入邮箱"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)],1),t("el-col",e._b({},"el-col",e.styleResponsive?{sm:12}:{span:12},!1),[t("el-form-item",{attrs:{label:"手机号:",prop:"phone"}},[t("el-input",{attrs:{clearable:"",maxlength:11,placeholder:"请输入手机号"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),t("el-form-item",{attrs:{label:"出生日期:",prop:"birthday"}},[t("el-date-picker",{staticClass:"ele-fluid",attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"请选择出生日期"},model:{value:e.form.birthday,callback:function(t){e.$set(e.form,"birthday",t)},expression:"form.birthday"}})],1),e.isUpdate?e._e():t("el-form-item",{attrs:{label:"登录密码:",prop:"password"}},[t("el-input",{attrs:{"show-password":"",maxlength:20,placeholder:"请输入登录密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),t("el-form-item",{attrs:{label:"个人简介:"}},[t("el-input",{attrs:{rows:4,clearable:"",type:"textarea",maxlength:200,placeholder:"请输入个人简介"},model:{value:e.form.introduction,callback:function(t){e.$set(e.form,"introduction",t)},expression:"form.introduction"}})],1)],1)],1)],1)],1)},r=[],o=(s(21703),s(33721)),n=s(84045),l=s(59477),i={components:{RoleSelect:n["default"]},props:{visible:Boolean,data:Object},data(){const e={userId:null,username:"",nickname:"",sex:null,roleIds:[],email:"",phone:"",birthday:"",password:"",introduction:""};return{defaultForm:e,form:{...e},rules:{username:[{required:!0,trigger:"blur",validator:(e,t,s)=>{if(!this.isUpdate)return t?void(0,l.mL)("username",t,this.data?.username).then((()=>{s(new Error("账号已经存在"))})).catch((()=>{s()})):s(new Error("请输入用户账号"));s()}}],nickname:[{required:!0,message:"请输入用户名",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",trigger:"blur"}],roleIds:[{required:!0,message:"请选择角色",trigger:"blur"}],email:[{pattern:o.m0,message:"邮箱格式不正确",trigger:"blur"}],password:[{required:!0,pattern:/^[\S]{5,18}$/,message:"密码必须为5-18位非空白字符",trigger:"blur"}],phone:[{pattern:o.$v,message:"手机号格式不正确",trigger:"blur"}]},loading:!1,isUpdate:!1}},computed:{styleResponsive(){return this.$store.state.theme.styleResponsive}},methods:{save(){this.$refs.form.validate((e=>{if(!e)return!1;this.loading=!0;const t={...this.form,roles:this.form.roleIds.map((e=>({roleId:e})))},s=this.isUpdate?l.Nq:l.cn;s(t).then((e=>{this.loading=!1,this.$message.success(e),this.updateVisible(!1),this.$emit("done")})).catch((e=>{this.loading=!1,this.$message.error(e.message)}))}))},updateVisible(e){this.$emit("update:visible",e)}},watch:{visible(e){e?this.data?(this.$util.assignObject(this.form,{...this.data,roleIds:this.data.roles.map((e=>e.roleId)),password:""}),this.isUpdate=!0):this.isUpdate=!1:(this.$refs.form.clearValidate(),this.form={...this.defaultForm})}}},c=i,u=s(1001),d=(0,u.Z)(c,a,r,!1,null,null,null),m=d.exports},1104:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("ele-modal",{attrs:{width:"520px",title:"导入用户",visible:e.visible},on:{"update:visible":e.updateVisible}},[t("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"ele-block",attrs:{drag:"",action:"",accept:".xls,.xlsx","show-file-list":!1,"before-upload":e.doUpload},scopedSlots:e._u([{key:"tip",fn:function(){return[t("div",{staticClass:"el-upload__tip ele-text-center"},[t("span",[e._v("只能上传xls、xlsx文件, ")]),t("el-link",{staticStyle:{"vertical-align":"baseline"},attrs:{download:"",href:e.url,type:"primary",underline:!1}},[e._v(" 下载模板 ")])],1)]},proxy:!0}])},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处, 或 "),t("em",[e._v("点击上传")])])])],1)},r=[],o=s(59477),n={props:{visible:Boolean},data(){return{loading:!1,url:"https://cdn.eleadmin.com/20200610/用户导入模板.xlsx"}},methods:{doUpload(e){return["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type)?e.size/1024/1024>10?(this.$message.error("大小不能超过 10MB"),!1):(this.loading=!0,(0,o.we)(e).then((e=>{this.loading=!1,this.$message.success(e),this.updateVisible(!1),this.$emit("done")})).catch((e=>{this.loading=!1,this.$message.error(e.message)})),!1):(this.$message.error("只能选择 excel 文件"),!1)},updateVisible(e){this.$emit("update:visible",e)}}},l=n,i=s(1001),c=(0,i.Z)(l,a,r,!1,null,"7ddf1efc",null),u=c.exports},4131:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("el-form",{staticClass:"ele-form-search",attrs:{"label-width":"77px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search.apply(null,arguments)},submit:function(e){e.preventDefault()}}},[t("el-row",{attrs:{gutter:15}},[t("el-col",e._b({},"el-col",e.styleResponsive?{lg:6,md:12}:{span:6},!1),[t("el-form-item",{attrs:{label:"用户账号:"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入"},model:{value:e.where.username,callback:function(t){e.$set(e.where,"username",t)},expression:"where.username"}})],1)],1),t("el-col",e._b({},"el-col",e.styleResponsive?{lg:6,md:12}:{span:6},!1),[t("el-form-item",{attrs:{label:"用户名:"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入"},model:{value:e.where.nickname,callback:function(t){e.$set(e.where,"nickname",t)},expression:"where.nickname"}})],1)],1),t("el-col",e._b({},"el-col",e.styleResponsive?{lg:6,md:12}:{span:6},!1),[t("el-form-item",{attrs:{label:"性别:"}},[t("el-select",{staticClass:"ele-fluid",attrs:{clearable:"",placeholder:"请选择"},model:{value:e.where.sex,callback:function(t){e.$set(e.where,"sex",t)},expression:"where.sex"}},[t("el-option",{attrs:{label:"男",value:1}}),t("el-option",{attrs:{label:"女",value:2}})],1)],1)],1),t("el-col",e._b({},"el-col",e.styleResponsive?{lg:6,md:12}:{span:6},!1),[t("div",{staticClass:"ele-form-actions"},[t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v(" 查询 ")]),t("el-button",{on:{click:e.reset}},[e._v("重置")])],1)])],1)],1)},r=[],o={data(){const e={username:"",nickname:"",sex:void 0};return{where:{...e}}},computed:{styleResponsive(){return this.$store.state.theme.styleResponsive}},methods:{search(){this.$emit("search",this.where)},reset(){this.where={...this.defaultWhere},this.search()}}},n=o,l=s(1001),i=(0,l.Z)(n,a,r,!1,null,null,null),c=i.exports},27953:function(e,t,s){s.r(t),s.d(t,{default:function(){return p}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ele-body"},[t("el-card",{attrs:{shadow:"never"}},[t("user-search",{on:{search:e.reload}}),t("ele-pro-table",{ref:"table",attrs:{columns:e.columns,datasource:e.datasource,selection:e.selection,"cache-key":"systemUserTable"},on:{"update:selection":function(t){e.selection=t}},scopedSlots:e._u([{key:"toolbar",fn:function(){return[t("el-button",{staticClass:"ele-btn-icon",attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.openEdit()}}},[e._v(" 新建 ")]),t("el-button",{staticClass:"ele-btn-icon",attrs:{size:"small",type:"danger",icon:"el-icon-delete"},on:{click:e.removeBatch}},[e._v(" 删除 ")]),t("el-button",{staticClass:"ele-btn-icon",attrs:{size:"small",icon:"el-icon-upload2"},on:{click:e.openImport}},[e._v(" 导入 ")])]},proxy:!0},{key:"nickname",fn:function({row:s}){return[t("router-link",{attrs:{to:"/system/user/details?id="+s.userId}},[e._v(" "+e._s(s.nickname)+" ")])]}},{key:"roles",fn:function({row:s}){return e._l(s.roles,(function(s){return t("el-tag",{key:s.roleId,attrs:{size:"mini",type:"primary","disable-transitions":!0}},[e._v(" "+e._s(s.roleName)+" ")])}))}},{key:"status",fn:function({row:s}){return[t("el-switch",{attrs:{"active-value":0,"inactive-value":1},on:{change:function(t){return e.editStatus(s)}},model:{value:s.status,callback:function(t){e.$set(s,"status",t)},expression:"row.status"}})]}},{key:"action",fn:function({row:s}){return[t("el-link",{attrs:{type:"primary",underline:!1,icon:"el-icon-edit"},on:{click:function(t){return e.openEdit(s)}}},[e._v(" 修改 ")]),t("el-link",{attrs:{type:"primary",underline:!1,icon:"el-icon-key"},on:{click:function(t){return e.resetPsw(s)}}},[e._v(" 重置密码 ")]),t("el-popconfirm",{staticClass:"ele-action",attrs:{title:"确定要删除此用户吗？"},on:{confirm:function(t){return e.remove(s)}},scopedSlots:e._u([{key:"reference",fn:function(){return[t("el-link",{attrs:{type:"danger",underline:!1,icon:"el-icon-delete"}},[e._v(" 删除 ")])]},proxy:!0}],null,!0)})]}}])})],1),t("user-edit",{attrs:{visible:e.showEdit,data:e.current},on:{"update:visible":function(t){e.showEdit=t},done:e.reload}}),t("user-import",{attrs:{visible:e.showImport},on:{"update:visible":function(t){e.showImport=t},done:e.reload}})],1)},r=[],o=s(4131),n=s(50221),l=s(1104),i=s(59477),c={name:"SystemUser",components:{UserSearch:o["default"],UserEdit:n["default"],UserImport:l["default"]},data(){return{columns:[{columnKey:"selection",type:"selection",width:45,align:"center",fixed:"left"},{columnKey:"index",type:"index",width:45,align:"center",showOverflowTooltip:!0,fixed:"left"},{prop:"username",label:"用户账号",sortable:"custom",showOverflowTooltip:!0,minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",showOverflowTooltip:!0,minWidth:110,slot:"nickname"},{prop:"sexName",label:"性别",sortable:"custom",showOverflowTooltip:!0,minWidth:80},{prop:"phone",label:"手机号",sortable:"custom",showOverflowTooltip:!0,minWidth:110},{columnKey:"roles",label:"角色",showOverflowTooltip:!0,minWidth:110,slot:"roles"},{prop:"createTime",label:"创建时间",sortable:"custom",showOverflowTooltip:!0,minWidth:110,formatter:(e,t,s)=>this.$util.toDateString(s)},{prop:"status",label:"状态",align:"center",sortable:"custom",width:80,resizable:!1,slot:"status",showOverflowTooltip:!0},{columnKey:"action",label:"操作",width:220,align:"center",resizable:!1,slot:"action",showOverflowTooltip:!0}],selection:[],current:null,showEdit:!1,showImport:!1}},methods:{datasource({page:e,limit:t,where:s,order:a}){return(0,i.I0)({...s,...a,page:e,limit:t})},reload(e){this.$refs.table.reload({page:1,where:e})},openEdit(e){this.current=e,this.showEdit=!0},openImport(){this.showImport=!0},remove(e){const t=this.$loading({lock:!0});(0,i.kX)(e.userId).then((e=>{t.close(),this.$message.success(e),this.reload()})).catch((e=>{t.close(),this.$message.error(e.message)}))},removeBatch(){this.selection.length?this.$confirm("确定要删除选中的用户吗?","提示",{type:"warning"}).then((()=>{const e=this.$loading({lock:!0});(0,i.bz)(this.selection.map((e=>e.userId))).then((t=>{e.close(),this.$message.success(t),this.reload()})).catch((t=>{e.close(),this.$message.error(t.message)}))})).catch((()=>{})):this.$message.error("请至少选择一条数据")},resetPsw(e){this.$confirm('确定要重置此用户的密码为"123456"吗?',"提示",{type:"warning"}).then((()=>{const t=this.$loading({lock:!0});(0,i.Zy)(e.userId).then((e=>{t.close(),this.$message.success(e)})).catch((e=>{t.close(),this.$message.error(e.message)}))})).catch((()=>{}))},editStatus(e){const t=this.$loading({lock:!0});(0,i.OL)(e.userId,e.status).then((e=>{t.close(),this.$message.success(e)})).catch((s=>{t.close(),e.status=e.status?0:1,this.$message.error(s.message)}))}}},u=c,d=s(1001),m=(0,d.Z)(u,a,r,!1,null,null,null),p=m.exports},33721:function(e,t,s){s.d(t,{$v:function(){return a},m0:function(){return r}});const a=/^1\d{10}$/,r=/^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/},49967:function(e,t,s){s.d(t,{AC:function(){return u},_d:function(){return n},fr:function(){return r},l5:function(){return i},rs:function(){return c},tO:function(){return d},ul:function(){return l},xv:function(){return o}});s(21703);var a=s(84471);async function r(e){const t=await a.Z.get("/system/role/page",{params:e});return 0===t.data.code?t.data.data:Promise.reject(new Error(t.data.message))}async function o(e){const t=await a.Z.get("/system/role",{params:e});return 0===t.data.code?t.data.data:Promise.reject(new Error(t.data.message))}async function n(e){const t=await a.Z.post("/system/role",e);return 0===t.data.code?t.data.message:Promise.reject(new Error(t.data.message))}async function l(e){const t=await a.Z.put("/system/role",e);return 0===t.data.code?t.data.message:Promise.reject(new Error(t.data.message))}async function i(e){const t=await a.Z["delete"]("/system/role/"+e);return 0===t.data.code?t.data.message:Promise.reject(new Error(t.data.message))}async function c(e){const t=await a.Z["delete"]("/system/role/batch",{data:e});return 0===t.data.code?t.data.message:Promise.reject(new Error(t.data.message))}async function u(e){const t=await a.Z.get("/system/role-menu/"+e);return 0===t.data.code?t.data.data:Promise.reject(new Error(t.data.message))}async function d(e,t){const s=await a.Z.put("/system/role-menu/"+e,t);return 0===s.data.code?s.data.message:Promise.reject(new Error(s.data.message))}},59477:function(e,t,s){s.d(t,{I0:function(){return r},Nq:function(){return i},OL:function(){return d},PR:function(){return n},Zy:function(){return m},bz:function(){return u},cn:function(){return l},kX:function(){return c},mL:function(){return f},we:function(){return p},yw:function(){return o}});s(21703);var a=s(84471);async function r(e){const t=await a.Z.get("/system/user/page",{params:e});return 0===t.data.code?t.data.data:Promise.reject(new Error(t.data.message))}async function o(e){const t=await a.Z.get("/system/user",{params:e});return 0===t.data.code&&t.data.data?t.data.data:Promise.reject(new Error(t.data.message))}async function n(e){const t=await a.Z.get("/system/user/"+e);return 0===t.data.code?t.data.data:Promise.reject(new Error(t.data.message))}async function l(e){const t=await a.Z.post("/system/user",e);return 0===t.data.code?t.data.message:Promise.reject(new Error(t.data.message))}async function i(e){const t=await a.Z.put("/system/user",e);return 0===t.data.code?t.data.message:Promise.reject(new Error(t.data.message))}async function c(e){const t=await a.Z["delete"]("/system/user/"+e);return 0===t.data.code?t.data.message:Promise.reject(new Error(t.data.message))}async function u(e){const t=await a.Z["delete"]("/system/user/batch",{data:e});return 0===t.data.code?t.data.message:Promise.reject(new Error(t.data.message))}async function d(e,t){const s=await a.Z.put("/system/user/status",{userId:e,status:t});return 0===s.data.code?s.data.message:Promise.reject(new Error(s.data.message))}async function m(e,t="123456"){const s=await a.Z.put("/system/user/password",{userId:e,password:t});return 0===s.data.code?s.data.message:Promise.reject(new Error(s.data.message))}async function p(e){const t=new FormData;t.append("file",e);const s=await a.Z.post("/system/user/import",t);return 0===s.data.code?s.data.message:Promise.reject(new Error(s.data.message))}async function f(e,t,s){const r=await a.Z.get("/system/user/existence",{params:{field:e,value:t,id:s}});return 0===r.data.code?r.data.message:Promise.reject(new Error(r.data.message))}}}]);